diff --git a/codebase/libxml2/HTMLparser.c b/codebase/libxml2/HTMLparser.c
index d6971b5..7f034a5 100644
--- a/codebase/libxml2/HTMLparser.c
+++ b/codebase/libxml2/HTMLparser.c
@@ -5392,6 +5392,9 @@ htmlParseTryOrFinish(htmlParserCtxtPtr ctxt, int terminate) {
 	    avail = in->length - (in->cur - in->base);
 	else
 	    avail = xmlBufUse(in->buf->buffer) - (in->cur - in->base);
+#ifdef MAGMA_ENABLE_CANARIES
+    MAGMA_LOG(30, avail != (in->end - in->cur));
+#endif
 	if ((avail == 0) && (terminate)) {
 	    htmlAutoCloseOnEnd(ctxt);
 	    if ((ctxt->nameNr == 0) && (ctxt->instate != XML_PARSER_EOF)) {
diff --git a/codebase/libxml2/parser.c b/codebase/libxml2/parser.c
index c962bfe..2e3e297 100644
--- a/codebase/libxml2/parser.c
+++ b/codebase/libxml2/parser.c
@@ -12491,12 +12491,14 @@ xmlHaltParser(xmlParserCtxtPtr ctxt) {
 	    ctxt->input->free((xmlChar *) ctxt->input->base);
 	    ctxt->input->free = NULL;
 	}
+#ifdef MAGMA_ENABLE_FIXES
         if (ctxt->input->buf != NULL) {
             xmlFreeParserInputBuffer(ctxt->input->buf);
             ctxt->input->buf = NULL;
         }
-	ctxt->input->cur = BAD_CAST"";
         ctxt->input->length = 0;
+#endif
+	ctxt->input->cur = BAD_CAST"";
 	ctxt->input->base = ctxt->input->cur;
         ctxt->input->end = ctxt->input->cur;
     }
