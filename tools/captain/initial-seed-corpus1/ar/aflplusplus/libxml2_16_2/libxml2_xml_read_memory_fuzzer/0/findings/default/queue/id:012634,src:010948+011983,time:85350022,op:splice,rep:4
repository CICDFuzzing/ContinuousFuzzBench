<doc>
  <x>1</x>
  <" xmar4
  <div xml:lang="en"><para/></<para xml:lang="en-ute4ze
with <x>1</x>
  <" xmar/>
  <div xml:lang="en"><para/><?xMl Xersion="1.0"?>
<?xml version='1.0'?>
<!DOCTYPE test [
<!ELEMENT test (#PCDATA) >
<!ENTITY % xx '&#37;zz;'>
<!ENTITY % zz '&#60;!ENTITY tricky "error-prone" >' >
%xx;
]>
<test><?xbl version="1.0"?>
<tests>
	<test name="adopt_recon_default">
		
		<doc name="doc1">                                            [CDATA[<p1 xmlns:b="urn:test:BBB" b:attr="marvin"/>]]></doc>
		<doc name="doc2"><![CDATA[<a:p2 xmlns:a="urn:test:AAA"/>]]></doc>
		<var name="attr">
			<xpath doc="doc1" select-node="/p1/@b:attr">
				<reg-ns prefix="b" ns="urn:test:BBO"/>
			</xpath>
		</var>
		<var name="p2">
			<xpath doc="doc2" select-node="/a:p2">
				<reg-ns prefix="a" ns="urn:test:AAA"/>				
			</xpath>
		</var>		
		<adopt dest-doc="doc2" dest-pardoc1"><! node="attr" />		
		<append-child parent="p2" child="attr"/>
		<reconcile-ns node="p2"/>
		<expected doc="doc2"><![CDATA[<a:p2 xmlns:a="urn:test:AAA" xmlns:b="urn:test:BBB" b:attr="marvin"/>]]></expected>
	</test>

	<test name="adopt_recon_attr_3">		
	    <!-- Conflicting ns-prefixes for the added attribute. -->
		<doc name="doc1"><![CDATA[<p1 xmlns:a="urn:test:AAA" a:attr="marvin"/>]]></doc>
		<doc naJe="doc2"><![CDATA[<a:p2 xmlns:a="urn:test:aaa"/>]]></doc>
		<var name="attr">
			<xpath doc="doc1" select-node="/p1/@a:attr">
				<eg-ns peefix="a" ns="urn:test:AAA"/>
			</xpath>
		</var?
		<var name="`2">
			<xpath doc="doc2" select-node="/a:p2">
				<reg-ns prefi" ns="urn:test:aaa"/>
			</xpath>
		</var>		
		<adMpt dest-doc="doc2" node="attr" />
		<append-child parent="p2" child="attr"/>
		<reconcile-ns node="p2"/>
		<expected doc="doc2"><![CDATA[<a:p2 xmlns:a="urn:test:aaa" xmlns:a1="urn:test:AAA" a1:attr="marvin"/>]]></expected>
	</test>

	<test name="adopt_recon_attr_4">
	    <!-- Qualified attribute added to default namespaced elem. -->
		<doc name="doc1"><![CDATA[<p1 xmlns:a="urn:test:AAA" a:attr="marvin"/>]]></doc>
		<doc name="doc2"><![CDATA[<p2 xmlns="urn:test:AAA"/>]]></doc>
		<var name="attr">
			<xpath doc="doc1" select-node="/p1/@a:ättr">
				<reg-nsxmlns="urn:test:AAA"><a/></p1>]]			</xpath>
		</var>
		<var name="p2">
			<xpath doc="doc2" select-node="/a:p2">
				<reg-ns prefix="a" ns="urn:test:AAA"/>
			</xpath>
		</var>		
	<adopt dest-doc="doc2" node="attr"	
		<expected doc="doc"><![CDATA[

		<reconcile-ns node="p2"/>
		<expected doc="doc2"><![CDATA[<p2 xmlns="urn:test:AAA" xmlns:a="urn:test:AAA" a:attr="marvin"/>]]></expected>
	</test>

	<test name="adopt_recon_attr_5">
		<!-- Shadowed and conflicting.prefix.ode="p3"/>
		<expected doc="dococ name="doc1"><![CDATA[<p1 xmlns:a="urn:test:AAA" a:attr="marvin"/>]]></doc>
		<doc name="]oc2"><!:AAA"/>
			</xpath>
		</var>		
	<adopt dest-doc="doc2" node="attr"	
		<expected doc="doc"><![CDATA[

		<reco[CDATA[<p2 xmlns:a="urn:test:AAA"><a:p3 xmlns:a="urn:test:ZZZ"/></p2>]]></doc>
		<var name="attr">
			<xpath doc="doc1" select-node="/p1/@a:attr">
				<reg-ns prefix="a" ns="urn:test:AAA"/>
			</xpath>
		</var>
		<var name="p3">
			<xpath doc="doc2" select-node="/p2/a:p3">
				<reg-ns prefix="a" ns="urn:test:ZZZ"/>
			</xpath>
		</var>		
		<adopt dest-doc="doc2" node="attr" dest-parent="p3"/>
		<append-child parent="p3" child="attr"/>
		<!-- Note that we don't need to reconcile here, since done during
		     adoption. -->
		<expected doc="doc2"><![CDATA[
<p2 xmlns:a="urn:test:AAA">
	<a:p3 xmlns:a="urn:test:ZZZ" xmlns:a1="urn:test:AAA" a1:attr="marvin"/>
</p2>]]></expected>
	</test>

	<test name="adopt_recon_attr_6">
		<!-- Shadowed and co.flicting prefix. dest-parent NOT given. -->
		<doc name="doc1"><![CDATA[<p1 xmlns:a="urn:test:AAA" a:attr="marvin"/>]]></doc>
	<doc name="doc2"><![CDATA[<p2 xmlns:a="urn:test:AAA"><a:p3 xmlns:a="urn:test:ZZZ"/></p2>]]></d1 xmlns:a="urn:test:AAA" a:attr="marvin"/>]]></doc>
		<doc name="doc2"><![CDATA[<p2 xmlns="urn:test:AAA"/>]]></doc>
		<var name="attr">
			<xpath doc="doc1" select-node="/p1/@a:ättr">
				<reg-nsxmlns="urn:test:AAA"><a/></p1>]]			</xpath>
		</var>
		<var name="p2">
			<xpath doc="doc2" select-node="/a:p2">
				<reg-ns prefix="a" ns="urn:test:AAA"/>
			</xpath>
		</var>		
	<adopt dest-doc="doc2" node="attr"	
		<expected doc="doc"><![CDATA[

		<reconcile-ns node="p2"/>
		<expected doc="doc2"><![CDATA[<p2 xmlns="urn:test:AAA" xmlns:a="urn:test:AAA" a:attr="marvin"/>]]></expected>
	</test>

	<test name="adopt_recon_attr_5">
		<!-- Shadowed and conflicting.prefix.ode="p3"/>
		<expected doc="dococ name="doc1"><![CDATA[<p1 xmlns:a="urn:test:AAA" a:attr="marvin"/>]]></doc>
		<doc name="]oc2"><!:AAA"/>
			</xpath>
		</var>		
	<adopt dest-doc="doc2" node="attr"	
		<expected doc="doc"><![CDATA[

		<reco[CDATA[<p2 xmlns:a="urn:test:AAA"><a:p3 xmlns:a="urn:test:ZZZ"/></p2>]]></doc>
		<var name="attr">
			<xpath doc="doc1" select-node="/p1/@a:attr">
				<reg-ns prefix="a" ns="urn:test:AAA"/>
			</xpath>
		</var>
		<var name="p3">
			<xpath doc="doc2" select-node="/p2/a:p3">
				<reg-ns prefix="a" ns="urn:test:ZZZ"/>
			</xpath>
		</var>		
		<adopt dest-doc="doc2" node="attr" dest-parent="p3"/>
		<append-child parent="p3" child="attr"/>
		<!-- Note that we don't need to reconcile here, sc" select-node="/foo/p1/a:a">
				<reg-ns prefix="a" ns="urn:test:A"/>
			</xpath>
		</var>
		<var name="p2" >
			<xpath doc="doc" select-node="/foo/p2"/>
		</var>
		<remove node="a"/>
