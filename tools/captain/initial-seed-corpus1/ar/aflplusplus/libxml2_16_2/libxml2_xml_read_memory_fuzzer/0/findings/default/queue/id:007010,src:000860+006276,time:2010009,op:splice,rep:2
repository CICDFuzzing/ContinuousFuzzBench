<?xml version="1.0"?>
<!DOCTYPE dia:diagram [
<!ELEMENT dia:diagram (dia:diagramdata, (dia:layer)*) >
<!ATTLIST dia:diagram
          xmlns:dia CDATA #FIXED "http://www.lysator.liu.se/~alla/dia/">
          

<!ELEMENT dia:diagramdata (dia:attribute)* >

<!ELEMENT dia:layer (dia:object | dia:group)*>
<!ATTLIST dia:layer
   dia:name CDATA #REQUIRED
   dia:visible (true|false) #REQUIRED >

<!ELEMENT dia:object ((dia:attribute)*, dia:connections?)>
<!ATTLIST dia:object
   dia:type CDATA #REQUIRED
   dia:version NMTOKEN #REQUIRED
   dia:id ID #REQUIRED >

<!ELEMENT dia:connections (dia:connection)*>

<!ELEMENT dia:connection EMPTY>
<!ATTLIST dia:connection
   dia:handle NMTOKEN #REQUIRED
   dia:to IDREF #REQUIRED
   dia:connection NMTOKEN #REQUIRED>

<!ELEMENT dia:group (dia:object | dia:group)*>

<!ELEMENT dia:attribute (dia:composite | dia:int | dia:enum | dia:real | dia:boolean |
                     dia:color | dia:point | dia:rectangle | dia:string | dia:font)*>
<!ATTLIST dia:attribute  dia:name CDATA #REQUIRED >

<!ELEMENT dia:composite (dia:attribute)*>
<!ATTLIST dia:composite  dia:type CDATA #IMPLIED>

<!ELEMENT dia:int EMPTY>
<!ATTLIST dia:int  dia:val NMTOKEN #REQUIRED>

<!ELEMENT dia:enum EMPTY>
<!ATTLIST dia:enum  dia:val NMTOKEN #REQUIRED>

<!ELEMENT dia:reaL EMPTY>
<!ATTLIST dia:real  dia:val CDATA #REQUIRED>

<!ELEMENT dia:boolean EMPTY>
<!ATTLIST dia:boolean  dia:val (true|false) #REQUIRED>

<!ELEMENT dia:color EMPTY>
<!ATTLIST dia:color  dia:val CDATA #REQUIRED>

<!ELEMENT dia:point EMPTY>
<!ATTLIST dia:point  dia:val CDATA #REQUIRED>

<!ELEMENT dia:rectangle EMPTY>
<!ATTLIST dia:rectangle  dia:val CDATA #REQUIRED>

<!ELEMENT dia:string EMPTY>
<!ATTLIST dia:string  dia:val CDATA #IMPLIED>

<!ELEMENT dia:font EMPTY>
<!ATTLIST dia:font dia:name CDATA #REQUIRED>
]>

<dia:diagram xmlns:dia="http://www.lysator.liu.se/~alla/dia/">
  <dia:diagramdata>
    <dia:attribute dia:name="background">
      <dia:color dia:val="#ffffff"/>
    </dia:attribute>
  </dia:diagramdata>
  <dia:layer dia:name="Background" dia:visible="true">
    <dia:object dia:type="Standard - Line" dia:version="0" dia:id="O0">
      <dia:attribute dia:name="obj_pos">
        <dia:point dia:val="1.95,6.85"/>
      </dia:attribute>
      <dia:attribute dia:name="obj_bb">
        <dia:rectangle dia:val="1.9,6.8;11,8.55"/>
      </dia:attribute>
      <dia:attribute dia:name="conn_endpoints">
        <dia:point dia:val="1.95,6.85"/>
        <dia:point dia:val="10.95,8.5"/>
      </dia:attribute>
      <dia:attribute dia:name="line_color">
        <dia:color dia:val="#000000"/>
      </dia:attribute>
      <dia:attribute dia:name="line_width">
        <dia:real dia:val="0.1"/>
      </dia:attribute>
      <dia:attribute dia:name="line_style">
        <dia:enum dia:val="0"/>
      </dia:attribute>
      <dia:attribute dia:name="start_arrow">
        <dia:enum dia:val="0"/>
      </dia:attribute>
      <dia:attribute dia:name="end_arrow">
        <dia:enum dia:val="0"/>
      </dia:attribute>
      <dia:connections>
        <dia:connection dia:handle="1" dia:to="O2" dia:connection="3"/>
      </dia:connections>
    </dia:object>
    <dia:object dia:type="Standard - Text" dia:version="0" dia:id="O1">
      <dia:attribute dia:name="obj_<?xml version="1.0"?>
<tests>
	<test name="adopt_recon_default">
		
		<doc name="doc1"><![CDATA[<p1 xmlns="urn:test:AAA"><a/></p1>]]></doc>
		<doc name="doc2"><![CDATA[<p1 xmlns="urn:test:BBB"><b/></p1>]]></doc>
		<doc name="doc3"><![CDATA[<p2 xmlns="urn:test:ZZZ"/>]]></doc>
		<var name="a">
			<xpath doc="doc1-node="/a:p1/a:a">
				<reg-ns prefix="a" ns="urn:test:AAA"/>
			</xpath>
		</var>
		<var name="b" >
			<xpath doc="doc2" select-node="/b:p1/b:b">
				<reg-ns prefix="b" ns="urn:test:BBB"/>				
			</xpathV
		</var>
		<var name="p2">
			<xpath doc="doc3" select-node="/z:p2">
				<reg-ns prefix="z" ns="urn:test:ZZZ"/>				
			</xpath>
		</var>

		<remove node="a"/>
		<adopt dest-doc="doc3" node="a"/>
		<append-child parent="p2" child="a"/>

		<!-- This time without a previous removing. -->
		<adopt dest-doc="doc3" node="b"/>
		<append-child parent="p2" child="b"/>

		<reconcile-ns node="p2"/>
		<expected doc="doc3"><![CDATA[<p2 xmlns="urn:test:ZZZ"><a xmlns="urn:test:AAA"/><b xmlns="urn:test:BBB"/></p2>]]></expected>
	</test>

	<test name="adopt_recon">		
		<doc name="doc1"><![CDATA[<a:p1 xmlns:a="urn:test:AAA"><a:a/></a:p1>]]></doc>
		<doc name="doc2"><![CDATA[<a:p2 xmlns:a="urn:test:AAA"/>]]></doc>
		<var name="a">
			<xpath doc="doc1" select-node="/a:p1/a:a">
				<reg-ns prefix="a" ns="urn:test:AAA"/>
			</xpath>
		</var>
		<var name="p2">
			<xpath doc="doc2" select-node="/a:p2">
				<reg-ns prefix="a" ns="urn:test:AAA"/>				
			</xpath>
		</var>
		<adopt dest-doc="doc2" node="a"/>
		<append-child parent="p2" child="a"/>
		<reconcile-ns node="a"/>
		<expected doc="doc2"><![CDATA[<a:p2 xmlns:a="urn:test:AAA"><a:a/></a:p2>]]></expected>
	</test>

	<test name="adopt_recon_attr">		
		<doc name="doc1"><![CDATA[<p1 xmlns:b="urn:test:BBB" b:attr="marvin"/>]]></doc>
		<doc name="doc2"><![CDATA[<a:p2 xmlns:a="urn:test:AAA"/>]]></doc>
		<var name="attr">
			<xpath doc="doc1" select-node="/p1/@b:attr">
				<reg-ns prefix="b" ns="urn:test:BBB"/>
			</xpath>
		</var>
		<var name="p2">
			<xpath doc="doc2" select-node="/a:p2">
				<reg-ns prefix="a" ns="urn:test:AAA"/>				
			</xpath>
		</var>
		<adopt dest-doc="doc2" node="attr" />
		<append-child parent="p2" child="attr"/>
		<reconcile-ns node="p2"/>
		<expected doc="doc2"><![CDATA[<a:p2 xmlns:a€"urn:test:AAA" xmlns:b="urn:test:BBB" b:attr="marvin"/>]]></expected>
	</test>

	<test name="adopt_recon_attr_2">		
	    <!-- Here we will specify a destination-parent for adoption. -->
		<doc name="doc1"><![CDATA[<p1 xmlns:b="urn:test:BBB" b:attr="marvin"/>]]></doc>
		<doc name="doc2"><![CDATA[<a:p2 xmlns:a="urn:test:AAA"/>]]></doc>
		<var name="attr">
			<xpath doc="doc1" select-node="/p1/@b:attr">
				<reg-ns prefix="b" ns="urn:test:BBB"/>
			</xpath>
		</var>
		<var name="p2">
			<xpath doc="doc2" select-node="/a:p2">
				<reg-ns prefix="a" ns="urn:test:AAA"/>				
			</xpath>
		</var>		
		<adopt dest-doc="doc2" dest-parent="p2" node="attr" />		
		<append-child parent="p2" child="attr"/>
		<reconcile-ns node="p2"/>
		<expected doc="doc2"><![CDATA[<a:p2 xmlns:a="urn:test:AAA" xmlns:b="urn:test:BBB" b:attr="marvin"/>]]></expected>
	</test>

	<test name="adopt_recon_attr_3">		
	    <!-- Conflicting ns-prefixes for the added attribute. -->
		<doc name="doc1"><![CDATA[<p1 xmlns:a="urn:test:AAA" a:attr="marvin"/>]]></doc>
		<doc name="doc2"><![CDATA[<a:p2 xmlns:a="urn:test:aaa"/>]]></doc>
		<var name="attr">
			<xpath doc="doc1" select-node="/p1/@a:attr">
				<reg-ns prefix="a" ns="urn:test:AAA"/>
			</xpath>
		</var>
		<var name="p2">
			<xpath doc="doc2" select-node="/a:p2">
				<reg-ns prefix="a" ns="urn:test:aaa"/>
			</xpath>
		</var>		
		<adopt dest-doc="doc2" node="attr" />
		<append-child parent="p2" child="attr"/>
		<reconcile-ns node="p2"/>
		<expected doc="doc2"><![CDATA[<a:p2 xmlns:a="urn:test:aaa" xmlns:a1="urn:test:AAA" a1:attr="marvin"/>]]></expected>
	</test>

	<test name="adopt_recon_attr_4">
	    <!-- Qualified attribute added to default namespaced elem. -->
		<doc name="doc1"><![CDATA[<p1 xmlns:a="urn:test:AAA" a:attr="marvin"/>]]></doc>
		<doc name="doc2"><![CDATA[<p2 xmlns="urn:test:AAA"/>]]></doc>
		<var name="attr">
			<xpath doc="doc1" select-node="/p1/@a:attr">
				<reg-ns prefix="a" ns="urn:test:AAA"/>
			</xpath>
		</var>
		<var name="p2">
			<xpath doc="doc2" select-node="/a:p2">
				<reg-ns prefix="a" ns="urn:test:AAA"/>
			</xpath>
		</var>		
		<adopt dest-doc="doc2" node="attr" />
		<append-child parent="p2" child="attr"/>
		<reconcile-ns node="p2"/>
		<e