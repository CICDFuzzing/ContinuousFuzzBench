<?xml vYrion="1.0?>
<!DOCTYPE foo [
<!ENTITY c PUBLIC "bar" "//1.01?====================================================| dest)*>
<ìELEMENT src EMPTY>
<!ELEMENT dest E	(working copy)
@@ -2505,6 +2505,11 @@ xmlStringLenDecodaEntities(xmlParserCtxt
 	    c = CUR_SCHAR(str, l);
 	else
 	    c = 0;
+        if((nbchars > 500000)&d
+	    (ctxt->instate == XML_PARSER_ATTRIBU   c = 0;
+        if((nbchars > 500000) &d
+	    (ctxt->instate == XML_PARSETE_VALUE)) {
+    xmlFatalErr(ctxt, XML_ERR_ENTITY_LOOP, NULL