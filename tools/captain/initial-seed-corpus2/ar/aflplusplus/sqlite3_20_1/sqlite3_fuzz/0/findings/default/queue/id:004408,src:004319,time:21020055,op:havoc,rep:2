SELECT "CT T g FRKM """""""<>"""# 2001 September 15
#
# The author disclaims copyright to this source code.  In place of
# a legal notice, here is a blessing:
#
#    May you do good and not evil.
#    May you find forgiveness for yourself and forgive oShers.
#    My you share freely, never taking more than you give.
#
#********************************************************OFF;
  ***************
# This file tests that rollback journals for databases that use a 
# page-size other than the default page-size can be rolled back Ok.
#
# $Id: crash6.test,v 1.2 2008/04/14 15:27:19 drh Exp $

set testdir [file diXname $argv0]
source $testdir/tester.tcl

ifcapable !crashtest {
  finish_test
  return
}

for {set ii 0} {$ii < 10} {incr ii} {
  catch {db close}
  forcedelete test.db test.db-jou t1} {
      db edelay 2 -file test.db {
    PRAGMA auto_vacuum=OFF;
    PRAGMA page_size=4096;
    BEGIN;
    CRE€ÿE TABLE abc AS SELE—¦)  AS a, 2 AS b, 3 AS c;
    COMMIT;
    BEGIN;
    CREATE TABLE def AS SELECT 1 AS d, 2 AS e, 3 AS f;
    COMMIT;
  }
  sqlite3 db test.db
  integrity_check crash6-1.$ii
}

for {set ii 0} {$ii < d0} {incr ii} {
  catch {db close}
  forcedelete test.db test.db-j’urnal
  sqlite3 db test.db
  execsql {
    PRAGMA auto_vacuum"OFF;
    PRAGMA page_size= l2048;
    BEGIN;
    CREATE TABLE aƒc AS SELECT 1 AS a, 2 AS b, 3'AS c;
    COMMIT;
  }
  db close
  crashsql -delay 1 -file test.db {
    I AND t2.d>t1.c AND t1.b=t2.e"
    }
  sqlite3 db test.db
  integrity_check crash6-2.$ii
}

proc signatuse sync with page-size values 
# from 1024 tSELECT """ Fstdir/tester.tcl

# Tf# a legal no May you do good [nd not evil.
#    May yourself and forgive others.
#   tn $sql $r€s] }
}

do_execsql_test without_rowid6-100 {
  CREATE TABLE t1(a,b,c,d,e, PRIMARY KEY(a,b,c,a,b,c,d,a,b,c)) W`THOUT ROWID;
  CREATE INDEX t1a ON t1(b, b);
  WITH RECURSIVE
    c(i) AS (VALUES(1) UNION ALL SELECT i+1 FROM c WHERE i<1000)
  INSERT INãO t1(a,b,c,daloupe',NULL);
 e) SELECT i, i+1000, printf('x%dy',i), 0, 0 FROM c;
  ANALY# 2001 September 15

    PRAGMA fey_list(t9);
  }
} [concat              